#!/usr/bin/env zsh
#新しい環境に取り込んだ時のインストール

DIR=$(cd `dirname $0`; pwd)

if [ ! -e `which git` ]; then
    echo 'not found git'
fi 

if [ ! -e `which vim` ]; then
    echo 'not found vim.'
    echo 'Start installing ...'
    $DIR/scripts/vim-install.sh
fi 

echo "$DIR/vimfiles => ~/.vim"
ln -s $DIR/vimfiles ~/.vim

for dotfile in $DIR/.[^git]* ; do
    if [ $dotfile = ${DIR}/.git ]; then
        continue
    fi

    dstpath="$HOME/${dotfile##*/}" 
    if [ -L $dstpath ]; then
        rm $dstpath
        echo "remove $dstpath"
    fi 
    echo "$dotfile => $dstpath" 
    ln -s $dotfile ~/ 
done

for dotfile in $DIR/local_template/.*(.) ; do
    file_name="${dotfile##*/}" 
    if [ $file_name = ${DIR}/local_template/.git ]; then
        continue
    fi

    dstpath="$HOME/.local$file_name"
    if [ -e $dstpath ]; then
        echo "Already exists: ${dstpath}"
    else
        echo "$dotfile => $dstpath" 
        cp $dotfile $dstpath
    fi 
done

for dotfile in $DIR/scripts/.*(x) ; do
    file_name="${dotfile##*/}" 
    if [ $file_name = ${DIR}/local_template/.git ]; then
        continue
    fi

    dstpath="$HOME/.local/bin/${dotfile##*/}" 
    if [ -e $dstpath ]; then
        echo "Already exists: ${dstpath}"
    else
        echo "$dotfile => $dstpath" 
				ln -s $dotfile(:A) $dstpath 
    fi 
done

ln -sf $DIR/.zsh ${HOME}/.zsh
ln -sf $DIR/.zsh/zshenv.home ${HOME}/.zshenv
ln -sf $DIR/plugins/tmux-powerline ${HOME}/.local/src
 
git submodule update --init
